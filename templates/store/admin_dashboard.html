{% extends 'base.html' %}
{% load static %}

{% block title %}Admin Dashboard - KitchenCrate{% endblock %}

{% block footer_content %}
<div class="row">
    <div class="col-md-6">
        <h5>KitchenCrate Admin</h5>
        <p>Professional food management system for efficient restaurant operations and order processing.</p>
    </div>
    <div class="col-md-6">
        <h5>Admin Tools</h5>
        <ul class="list-unstyled">
            <li><a href="{% url 'store:admin_dashboard' %}" class="text-decoration-none">Dashboard</a></li>
        </ul>
    </div>
</div>
<hr>
<div class="text-center">
    <p>&copy; 2025 KitchenCrate Admin Panel. All rights reserved.</p>
</div>
{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="hero-section">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6">
                <h1 class="hero-title">Admin Dashboard</h1>
                <p class="hero-subtitle">Manage your products, categories, and view analytics from one central location.</p>
                <div class="d-flex align-items-center mb-3">
                    <div class="bg-gradient-accent rounded-circle d-inline-block p-3 me-3" style="width: 60px; height: 60px;">
                        <i class="fas fa-chart-bar fa-2x text-primary"></i>
                    </div>
                    <div class="bg-gradient-accent rounded-circle d-inline-block p-3 me-3" style="width: 60px; height: 60px;">
                        <i class="fas fa-shopping-cart fa-2x text-primary"></i>
                    </div>
                    <div class="bg-gradient-accent rounded-circle d-inline-block p-3 me-3" style="width: 60px; height: 60px;">
                        <i class="fas fa-credit-card fa-2x text-primary"></i>
                    </div>
                    <div class="bg-gradient-accent rounded-circle d-inline-block p-3" style="width: 60px; height: 60px;">
                        <i class="fas fa-cogs fa-2x text-primary"></i>
                    </div>
                </div>
            </div>
            <div class="col-lg-6 text-center">
                <div class="position-relative">
                    <div class="bg-gradient-accent rounded-circle d-inline-block p-5" style="width: 300px; height: 300px;">
                        <i class="fas fa-tachometer-alt fa-5x text-primary"></i>
                    </div>
                </div>
            </div>
        </div>
        <div class="row mt-3">
            <div class="col-12 text-end">
                <a href="{% url 'store:admin_logout' %}" class="btn btn-outline-danger">
                    <i class="fas fa-sign-out-alt"></i> Logout from Admin
                </a>
            </div>
        </div>
        

    </div>
</div>

<div class="container">
    <!-- Statistics Cards -->
    <div class="row mb-4">
        <div class="col-6 col-md-3 mb-3">
            <div class="card bg-primary text-white h-100">
                <div class="card-body p-3">
                    <div class="d-flex flex-column align-items-center text-center">
                        <div class="mb-2">
                            <i class="fas fa-shopping-cart fa-2x"></i>
                        </div>
                        <h3 class="mb-1 fw-bold">{{ total_orders }}</h3>
                        <small class="opacity-75">Total Orders</small>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-6 col-md-3 mb-3">
            <div class="card bg-warning text-white h-100">
                <div class="card-body p-3">
                    <div class="d-flex flex-column align-items-center text-center">
                        <div class="mb-2">
                            <i class="fas fa-clock fa-2x"></i>
                        </div>
                        <h3 class="mb-1 fw-bold">{{ pending_orders }}</h3>
                        <small class="opacity-75">Pending Orders</small>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-6 col-md-3 mb-3">
            <div class="card bg-success text-white h-100">
                <div class="card-body p-3">
                    <div class="d-flex flex-column align-items-center text-center">
                        <div class="mb-2">
                            <i class="fas fa-naira-sign fa-2x"></i>
                        </div>
                        <h3 class="mb-1 fw-bold">₦{{ total_revenue|floatformat:0 }}</h3>
                        <small class="opacity-75">Total Revenue</small>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-6 col-md-3 mb-3">
            <div class="card bg-info text-white h-100">
                <div class="card-body p-3">
                    <div class="d-flex flex-column align-items-center text-center">
                        <div class="mb-2">
                            <i class="fas fa-check-circle fa-2x"></i>
                        </div>
                        <h3 class="mb-1 fw-bold">{{ completed_payments }}</h3>
                        <small class="opacity-75">Completed Payments</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Orders Section -->
    <div class="card shadow-lg mb-4">
        <div class="card-header">
            <h4 class="mb-0"><i class="fas fa-list"></i> Recent Orders</h4>
        </div>
        <div class="card-body p-0">
            {% if recent_orders %}
            <!-- Desktop Table -->
            <div class="table-responsive d-none d-md-block">
                <table class="table table-hover mb-0">
                    <thead>
                        <tr>
                            <th>Order ID</th>
                            <th>Customer</th>
                            <th>Items</th>
                            <th>Total</th>
                            <th>Payment Status</th>
                            <th>Order Status</th>
                            <th>Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for order in recent_orders %}
                        <tr>
                            <td>
                                <strong>#{{ order.id }}</strong>
                            </td>
                            <td>
                                {{ order.first_name }} {{ order.last_name }}
                                <br>
                                <small class="text-muted">{{ order.email }}</small>
                            </td>
                            <td>
                                {% for item in order.items.all %}
                                <span class="badge bg-secondary me-1">{{ item.product.name }} ({{ item.quantity }})</span>
                                {% endfor %}
                            </td>
                            <td>
                                <span class="fw-bold">₦{{ order.get_total_cost|floatformat:2 }}</span>
                            </td>
                            <td>
                                {% if order.payment_status == 'completed' %}
                                <span class="badge bg-success">Paid</span>
                                {% elif order.payment_status == 'pending' %}
                                <span class="badge bg-warning">Pending</span>
                                {% elif order.payment_status == 'failed' %}
                                <span class="badge bg-danger">Failed</span>
                                {% else %}
                                <span class="badge bg-secondary">{{ order.get_payment_status_display }}</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if order.status == 'delivered' %}
                                <span class="badge bg-success">Delivered</span>
                                {% elif order.status == 'processing' %}
                                <span class="badge bg-info">Processing</span>
                                {% elif order.status == 'shipped' %}
                                <span class="badge bg-primary">Shipped</span>
                                {% elif order.status == 'pending' %}
                                <span class="badge bg-warning">Pending</span>
                                {% else %}
                                <span class="badge bg-secondary">{{ order.get_status_display }}</span>
                                {% endif %}
                            </td>
                            <td>
                                <small>{{ order.created|date:"M j, Y" }}</small>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            
            <!-- Mobile Cards -->
            <div class="d-md-none">
                {% for order in recent_orders %}
                <div class="card border-0 border-bottom rounded-0">
                    <div class="card-body p-3">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div>
                                <h6 class="mb-1 fw-bold">#{{ order.id }}</h6>
                                <p class="mb-1 text-muted small">{{ order.first_name }} {{ order.last_name }}</p>
                                <p class="mb-0 text-muted small">{{ order.email }}</p>
                            </div>
                            <div class="text-end">
                                <h6 class="mb-1 fw-bold text-primary">₦{{ order.get_total_cost|floatformat:2 }}</h6>
                                <small class="text-muted">{{ order.created|date:"M j, Y" }}</small>
                            </div>
                        </div>
                        
                        <div class="mb-2">
                            {% for item in order.items.all %}
                            <span class="badge bg-light text-dark me-1 mb-1">{{ item.product.name }} ({{ item.quantity }})</span>
                            {% endfor %}
                        </div>
                        
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                {% if order.payment_status == 'completed' %}
                                <span class="badge bg-success">Paid</span>
                                {% elif order.payment_status == 'pending' %}
                                <span class="badge bg-warning">Pending</span>
                                {% elif order.payment_status == 'failed' %}
                                <span class="badge bg-danger">Failed</span>
                                {% else %}
                                <span class="badge bg-secondary">{{ order.get_payment_status_display }}</span>
                                {% endif %}
                            </div>
                            <div>
                                {% if order.status == 'delivered' %}
                                <span class="badge bg-success">Delivered</span>
                                {% elif order.status == 'processing' %}
                                <span class="badge bg-info">Processing</span>
                                {% elif order.status == 'shipped' %}
                                <span class="badge bg-primary">Shipped</span>
                                {% elif order.status == 'pending' %}
                                <span class="badge bg-warning">Pending</span>
                                {% else %}
                                <span class="badge bg-secondary">{{ order.get_status_display }}</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="text-center py-5">
                <i class="fas fa-shopping-cart fa-3x text-muted mb-3"></i>
                <h5>No orders yet</h5>
                <p class="text-muted">Orders will appear here once customers start placing them.</p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Create Category Form -->
    <div class="card shadow-lg mb-4">
        <div class="card-header bg-info text-white">
            <h4 class="mb-0"><i class="fas fa-tags"></i> Create Category</h4>
        </div>
        <div class="card-body">
            <form method="post" class="row g-3">
                {% csrf_token %}
                <input type="hidden" name="action" value="add_category">
                <div class="col-12 col-md-4">
                    <label for="id_name" class="form-label fw-bold">Category Name</label>
                    {{ category_form.name }}
                    {% if category_form.name.errors %}
                    <div class="text-danger small">{{ category_form.name.errors.0 }}</div>
                    {% endif %}
                </div>
                <div class="col-12 col-md-4">
                    <label for="id_slug" class="form-label fw-bold">Slug</label>
                    {{ category_form.slug }}
                    {% if category_form.slug.errors %}
                    <div class="text-danger small">{{ category_form.slug.errors.0 }}</div>
                    {% endif %}
                </div>
                <div class="col-12 col-md-4">
                    <label for="id_description" class="form-label fw-bold">Description</label>
                    {{ category_form.description }}
                    {% if category_form.description.errors %}
                    <div class="text-danger small">{{ category_form.description.errors.0 }}</div>
                    {% endif %}
                </div>
                <div class="col-12">
                    <button type="submit" class="btn btn-info btn-lg w-100 w-md-auto">
                        <i class="fas fa-plus"></i> Add Category
                    </button>
                </div>
            </form>
            {% if category_message %}
            <div class="alert alert-danger mt-3">{{ category_message }}</div>
            {% endif %}
        </div>
    </div>
    <!-- List of Categories -->
    <div class="mb-5">
        <h5>Existing Categories:</h5>
        <ul class="list-inline">
            {% for cat in categories %}
            <li class="list-inline-item badge bg-secondary mb-1 d-flex align-items-center" style="gap: 0.5rem;">
                {{ cat.name }}
                <form method="post" style="display:inline; margin-left: 5px;" onsubmit="return confirm('Are you sure you want to delete the category \"{{ cat.name }}\"? This will remove all associated products!');">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="delete_category">
                    <input type="hidden" name="category_id" value="{{ cat.id }}">
                    <button type="submit" class="btn btn-sm btn-danger" title="Delete Category">
                        <i class="fas fa-trash"></i>
                    </button>
                </form>
            </li>
            {% empty %}
            <li>No categories yet.</li>
            {% endfor %}
        </ul>
    </div>

    <!-- Add Food Form -->
    <div class="card shadow-lg mb-5" id="add-food-form">
        <div class="card-header">
            <h4 class="mb-0"><i class="fas fa-plus"></i> Add New Food</h4>
        </div>
        <div class="card-body">
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <input type="hidden" name="action" value="add_product">
                <div class="row">
                    <div class="col-12 col-md-6">
                        <div class="mb-3">
                            <label for="{{ form.name.id_for_label }}" class="form-label fw-bold">
                                {{ form.name.label }}
                            </label>
                            {{ form.name }}
                            {% if form.name.errors %}
                            <div class="text-danger small">{{ form.name.errors.0 }}</div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="col-12 col-md-6">
                        <div class="mb-3">
                            <label for="{{ form.category.id_for_label }}" class="form-label fw-bold">
                                {{ form.category.label }}
                            </label>
                            {{ form.category }}
                            {% if form.category.errors %}
                            <div class="text-danger small">{{ form.category.errors.0 }}</div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <div class="mb-3">
                    <label for="{{ form.description.id_for_label }}" class="form-label fw-bold">
                        {{ form.description.label }}
                    </label>
                    {{ form.description }}
                    {% if form.description.errors %}
                    <div class="text-danger small">{{ form.description.errors.0 }}</div>
                    {% endif %}
                </div>
                <div class="row">
                    <div class="col-12 col-md-4">
                        <div class="mb-3">
                            <label for="{{ form.price.id_for_label }}" class="form-label fw-bold">
                                {{ form.price.label }}
                            </label>
                            {{ form.price }}
                            {% if form.price.errors %}
                            <div class="text-danger small">{{ form.price.errors.0 }}</div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="col-12 col-md-4">
                        <div class="mb-3">
                            <label for="{{ form.stock.id_for_label }}" class="form-label fw-bold">
                                {{ form.stock.label }}
                            </label>
                            {{ form.stock }}
                            {% if form.stock.errors %}
                            <div class="text-danger small">{{ form.stock.errors.0 }}</div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="col-12 col-md-4">
                        <div class="mb-3">
                            <label for="{{ form.image.id_for_label }}" class="form-label fw-bold">
                                {{ form.image.label }}
                            </label>
                            {{ form.image }}
                            {% if form.image.errors %}
                            <div class="text-danger small">{{ form.image.errors.0 }}</div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <div class="mb-3">
                    <div class="form-check">
                        {{ form.available }}
                        <label class="form-check-label fw-bold" for="{{ form.available.id_for_label }}">
                            {{ form.available.label }}
                        </label>
                    </div>
                </div>
                <button type="submit" class="btn btn-success btn-lg w-100 w-md-auto">
                    <i class="fas fa-save"></i> Add Food
                </button>
            </form>
        </div>
    </div>

    <!-- Food Management -->
    <div class="card shadow-lg">
        <div class="card-header">
            <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-3">
                <h4 class="mb-0"><i class="fas fa-list"></i> Food Management</h4>
                <div class="d-flex flex-column flex-md-row gap-2 w-100 w-md-auto">
                    <form method="get" class="d-flex me-md-3 mb-2 mb-md-0 search-form">
                        <input type="text" name="search" class="form-control me-2" 
                               placeholder="Search foods..." value="{{ search_query }}">
                        <button type="submit" class="btn btn-outline-primary">
                            <i class="fas fa-search"></i>
                        </button>
                    </form>
                    <div class="btn-group w-100 w-md-auto filter-buttons">
                        <a href="?{% if search_query %}search={{ search_query }}&{% endif %}" 
                           class="btn btn-outline-secondary {% if not available_filter %}active{% endif %}">
                            All
                        </a>
                        <a href="?{% if search_query %}search={{ search_query }}&{% endif %}available=true" 
                           class="btn btn-outline-success {% if available_filter == 'true' %}active{% endif %}">
                            Available
                        </a>
                        <a href="?{% if search_query %}search={{ search_query }}&{% endif %}available=false" 
                           class="btn btn-outline-warning {% if available_filter == 'false' %}active{% endif %}">
                            Unavailable
                        </a>
                    </div>
                </div>
            </div>
        </div>
        <div class="card-body p-0">
            {% if products %}
            <!-- Desktop Table -->
            <div class="table-responsive d-none d-md-block">
                <table class="table table-hover mb-0">
                    <thead>
                        <tr>
                            <th>Image</th>
                            <th>Name</th>
                            <th>Category</th>
                            <th>Price</th>
                            <th>Stock</th>
                            <th>Status</th>
                            <th>Created</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for product in products %}
                        <tr>
                            <td>
                                {% if product.image %}
                                <img src="{{ product.image.url }}" alt="{{ product.name }}" 
                                     style="width: 50px; height: 50px; object-fit: cover; border-radius: 5px;">
                                {% else %}
                                <div class="bg-light d-flex align-items-center justify-content-center" 
                                     style="width: 50px; height: 50px; border-radius: 5px;">
                                    <i class="fas fa-image text-muted"></i>
                                </div>
                                {% endif %}
                            </td>
                            <td>
                                <strong>{{ product.name }}</strong>
                                <br>
                                <small class="text-muted">{{ product.slug }}</small>
                            </td>
                            <td>
                                <span class="badge bg-primary">{{ product.category.name }}</span>
                            </td>
                            <td>
                                <span class="fw-bold product-price">₦{{ product.price }}</span>
                            </td>
                            <td>
                                <span class="fw-bold {% if product.stock > 10 %}text-success{% elif product.stock > 0 %}text-warning{% else %}text-danger{% endif %}">
                                    {{ product.stock }}
                                </span>
                            </td>
                            <td>
                                {% if product.available %}
                                <span class="badge bg-success">Available</span>
                                {% else %}
                                <span class="badge bg-danger">Unavailable</span>
                                {% endif %}
                            </td>
                            <td>
                                <small>{{ product.created_at|date:"M j, Y" }}</small>
                            </td>
                            <td>
                                <div class="btn-group" role="group">
                                    <button type="button" class="btn btn-sm btn-outline-warning" 
                                            onclick="editProduct({{ product.id }}, '{{ product.name }}', '{{ product.description }}', {{ product.price }}, {{ product.stock }}, {{ product.available|yesno:'true,false' }}, {{ product.category.id }})" 
                                            title="Edit">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <form method="post" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this food item?')">
                                        {% csrf_token %}
                                        <input type="hidden" name="action" value="delete_product">
                                        <input type="hidden" name="product_id" value="{{ product.id }}">
                                        <button type="submit" class="btn btn-sm btn-outline-danger" title="Delete">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            
            <!-- Mobile Food Cards -->
            <div class="d-md-none">
                {% for product in products %}
                <div class="card border-0 border-bottom rounded-0 food-card">
                    <div class="card-body p-3">
                        <div class="row align-items-center">
                            <div class="col-3">
                                {% if product.image %}
                                <img src="{{ product.image.url }}" alt="{{ product.name }}" 
                                     class="img-fluid rounded food-image" style="width: 100%; height: 80px; object-fit: cover;">
                                {% else %}
                                <div class="bg-light d-flex align-items-center justify-content-center rounded food-image" 
                                     style="width: 100%; height: 80px;">
                                    <i class="fas fa-image text-muted fa-2x"></i>
                                </div>
                                {% endif %}
                            </div>
                            <div class="col-9">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <div class="flex-grow-1 food-info">
                                        <h6 class="mb-1 fw-bold">{{ product.name }}</h6>
                                        <p class="mb-1 text-muted small">{{ product.category.name }}</p>
                                        <div class="d-flex align-items-center gap-2 food-price-stock">
                                            <span class="fw-bold text-primary">₦{{ product.price }}</span>
                                            <span class="fw-bold {% if product.stock > 10 %}text-success{% elif product.stock > 0 %}text-warning{% else %}text-danger{% endif %}">
                                                Stock: {{ product.stock }}
                                            </span>
                                        </div>
                                    </div>
                                    <div class="text-end">
                                        {% if product.available %}
                                        <span class="badge bg-success">Available</span>
                                        {% else %}
                                        <span class="badge bg-danger">Unavailable</span>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-muted">{{ product.created_at|date:"M j, Y" }}</small>
                                    <div class="btn-group btn-group-sm food-actions" role="group">
                                        <button type="button" class="btn btn-outline-warning btn-sm" 
                                                onclick="editProduct({{ product.id }}, '{{ product.name }}', '{{ product.description }}', {{ product.price }}, {{ product.stock }}, {{ product.available|yesno:'true,false' }}, {{ product.category.id }})" 
                                                title="Edit">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <form method="post" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this food item?')">
                                            {% csrf_token %}
                                            <input type="hidden" name="action" value="delete_product">
                                            <input type="hidden" name="product_id" value="{{ product.id }}">
                                            <button type="submit" class="btn btn-outline-danger btn-sm" title="Delete">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Pagination -->
            {% if products.has_other_pages %}
            <div class="card-footer bg-transparent border-0">
                <nav aria-label="Food pagination">
                    <ul class="pagination justify-content-center mb-0">
                        {% if products.has_previous %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ products.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if available_filter %}&available={{ available_filter }}{% endif %}">
                                <i class="fas fa-angle-left"></i> <span class="d-none d-sm-inline">Previous</span>
                            </a>
                        </li>
                        {% endif %}

                        {% for num in products.paginator.page_range %}
                        {% if products.number == num %}
                        <li class="page-item active">
                            <span class="page-link">{{ num }}</span>
                        </li>
                        {% elif num > products.number|add:'-3' and num < products.number|add:'3' %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ num }}{% if search_query %}&search={{ search_query }}{% endif %}{% if available_filter %}&available={{ available_filter }}{% endif %}">{{ num }}</a>
                        </li>
                        {% endif %}
                        {% endfor %}

                        {% if products.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ products.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if available_filter %}&available={{ available_filter }}{% endif %}">
                                <span class="d-none d-sm-inline">Next</span> <i class="fas fa-angle-right"></i>
                            </a>
                        </li>
                        {% endif %}
                    </ul>
                </nav>
            </div>
            {% endif %}

            {% else %}
            <div class="text-center py-5 px-3 empty-state">
                <div class="bg-gradient-accent rounded-circle d-inline-block p-4 p-md-5 mb-4 icon" style="width: 120px; height: 120px; max-width: 150px; max-height: 150px;">
                    <i class="fas fa-utensils fa-2x fa-md-3x text-primary"></i>
                </div>
                <h4 class="section-title mb-3">No food items found</h4>
                <p class="section-subtitle text-muted">
                    {% if search_query %}
                    No food items match your search criteria.
                    {% else %}
                    Start by adding your first food item using the form above.
                    {% endif %}
                </p>
                <div class="mt-4">
                    <a href="#add-food-form" class="btn btn-primary btn-lg">
                        <i class="fas fa-plus me-2"></i>Add First Food Item
                    </a>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Edit Product Modal -->
<div class="modal fade" id="editProductModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Product</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <input type="hidden" name="action" value="edit_product">
                <input type="hidden" name="product_id" id="edit_product_id">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="edit_name" class="form-label fw-bold">Product Name</label>
                                <input type="text" class="form-control" id="edit_name" name="name" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="edit_category" class="form-label fw-bold">Category</label>
                                <select class="form-select" id="edit_category" name="category" required>
                                    {% for category in form.category.field.queryset %}
                                    <option value="{{ category.id }}">{{ category.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="edit_description" class="form-label fw-bold">Description</label>
                        <textarea class="form-control" id="edit_description" name="description" rows="3"></textarea>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="edit_price" class="form-label fw-bold">Price (₦)</label>
                                <input type="number" class="form-control" id="edit_price" name="price" step="0.01" min="0" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="edit_stock" class="form-label fw-bold">Stock</label>
                                <input type="number" class="form-control" id="edit_stock" name="stock" min="0" required>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="edit_available" name="available">
                            <label class="form-check-label fw-bold" for="edit_available">
                                Available for Purchase
                            </label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Update Product</button>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
/* Mobile-specific styles */
@media (max-width: 768px) {
    .hero-section {
        padding: 2rem 0;
    }
    
    .hero-title {
        font-size: 2rem;
    }
    
    .hero-subtitle {
        font-size: 1rem;
    }
    
    /* Statistics cards */
    .card-body {
        padding: 1rem;
    }
    
    /* Form improvements */
    .form-control, .form-select {
        font-size: 16px; /* Prevents zoom on iOS */
        padding: 0.75rem;
        border-radius: 10px;
    }
    
    .form-label {
        font-size: 0.9rem;
        margin-bottom: 0.5rem;
    }
    
    /* Button improvements */
    .btn {
        padding: 0.75rem 1.5rem;
        font-size: 0.9rem;
        border-radius: 10px;
    }
    
    .btn-lg {
        padding: 1rem 2rem;
        font-size: 1rem;
    }
    
    /* Table improvements */
    .table {
        font-size: 0.85rem;
    }
    
    .table th, .table td {
        padding: 0.75rem 0.5rem;
    }
    
    /* Badge improvements */
    .badge {
        font-size: 0.75rem;
        padding: 0.5rem 0.75rem;
    }
    
    /* Card improvements */
    .card {
        border-radius: 15px;
        margin-bottom: 1rem;
    }
    
    .card-header {
        border-radius: 15px 15px 0 0 !important;
        padding: 1rem;
    }
    
    /* Modal improvements */
    .modal-dialog {
        margin: 1rem;
    }
    
    .modal-content {
        border-radius: 15px;
    }
    
    /* Touch-friendly spacing */
    .mb-3 {
        margin-bottom: 1rem !important;
    }
    
    .p-3 {
        padding: 1rem !important;
    }
    
    /* Better mobile navigation */
    .navbar {
        padding: 0.5rem 0;
    }
    
    /* Mobile-specific grid */
    .row > * {
        margin-bottom: 1rem;
    }
    
    /* Mobile form layout */
    .row .col-12 {
        margin-bottom: 1rem;
    }
    
    /* Mobile button groups */
    .btn-group .btn {
        flex: 1;
        min-height: 44px;
    }
    
    /* Mobile search form */
    .d-flex .form-control {
        min-height: 44px;
    }
    
    /* Mobile table responsiveness */
    .table-responsive {
        border-radius: 10px;
        overflow: hidden;
    }
    
    /* Mobile card shadows */
    .card {
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    
    /* Mobile text sizing */
    h4 {
        font-size: 1.25rem;
    }
    
    h5 {
        font-size: 1.1rem;
    }
    
    h6 {
        font-size: 1rem;
    }
    
    /* Mobile spacing utilities */
    .mobile-p-2 {
        padding: 0.75rem !important;
    }
    
    .mobile-mb-2 {
        margin-bottom: 0.75rem !important;
    }
}

/* Extra small devices */
@media (max-width: 576px) {
    .container {
        padding-left: 10px;
        padding-right: 10px;
    }
    
    .hero-title {
        font-size: 1.75rem;
    }
    
    .card-body {
        padding: 0.75rem;
    }
    
    .btn {
        padding: 0.875rem 1.25rem;
    }
    
    .table {
        font-size: 0.8rem;
    }
    
    .badge {
        font-size: 0.7rem;
        padding: 0.4rem 0.6rem;
    }
}

/* Landscape mobile optimization */
@media (max-width: 768px) and (orientation: landscape) {
    .hero-section {
        padding: 1rem 0;
    }
    
    .hero-title {
        font-size: 1.5rem;
    }
    
    .card-body {
        padding: 0.5rem;
    }
}

/* High DPI mobile devices */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
    .card {
        box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }
}

/* Mobile performance optimizations */
@media (max-width: 768px) {
    /* Reduce animations for better performance */
    .card:hover {
        transform: none;
    }
    
    .btn:hover {
        transform: none;
    }
    
    /* Better touch targets */
    .btn, .form-control, .form-select {
        min-height: 44px;
    }
    
    /* Optimize scrolling */
    .table-responsive {
        -webkit-overflow-scrolling: touch;
    }
    
    /* Food Management Mobile Styles */
    .food-card {
        transition: all 0.2s ease;
    }
    
    .food-card:active {
        transform: scale(0.98);
        background-color: rgba(0,0,0,0.02);
    }
    
    /* Mobile food image optimization */
    .food-image {
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    /* Mobile button group improvements */
    .btn-group-sm .btn {
        padding: 0.5rem 0.75rem;
        font-size: 0.875rem;
        min-height: 38px;
    }
    
    /* Mobile pagination improvements */
    .pagination .page-link {
        padding: 0.75rem 0.5rem;
        min-width: 44px;
        text-align: center;
    }
    
    /* Mobile search improvements */
    .search-form {
        margin-bottom: 1rem;
    }
    
    .search-form .form-control {
        border-radius: 25px;
        padding-left: 1rem;
        padding-right: 1rem;
    }
    
    .search-form .btn {
        border-radius: 25px;
        padding-left: 1.5rem;
        padding-right: 1.5rem;
    }
    
    /* Mobile filter buttons */
    .filter-buttons .btn {
        flex: 1;
        border-radius: 20px;
        font-size: 0.875rem;
        padding: 0.5rem 1rem;
    }
    
    /* Mobile food card spacing */
    .food-card .card-body {
        padding: 1rem;
    }
    
    .food-card .row {
        margin: 0;
    }
    
    .food-card .col-3,
    .food-card .col-9 {
        padding: 0 0.5rem;
    }
    
    /* Mobile food info layout */
    .food-info h6 {
        font-size: 1rem;
        line-height: 1.3;
        margin-bottom: 0.25rem;
    }
    
    .food-info p {
        font-size: 0.875rem;
        margin-bottom: 0.5rem;
    }
    
    .food-price-stock {
        font-size: 0.875rem;
    }
    
    /* Mobile action buttons */
    .food-actions .btn-group {
        gap: 0.25rem;
    }
    
    .food-actions .btn {
        border-radius: 6px;
        padding: 0.375rem 0.75rem;
    }
    
    /* Mobile empty state */
    .empty-state {
        padding: 3rem 1rem;
    }
    
    .empty-state .icon {
        width: 80px;
        height: 80px;
        margin: 0 auto 1.5rem;
    }
    
    .empty-state h4 {
        font-size: 1.25rem;
        margin-bottom: 1rem;
    }
    
    .empty-state p {
        font-size: 0.9rem;
        line-height: 1.5;
    }
    
    .empty-state .btn {
        margin-top: 1.5rem;
        padding: 0.75rem 2rem;
        border-radius: 25px;
    }
}
</style>

<script>
function editProduct(id, name, description, price, stock, available, categoryId) {
    document.getElementById('edit_product_id').value = id;
    document.getElementById('edit_name').value = name;
    document.getElementById('edit_description').value = description;
    document.getElementById('edit_price').value = price;
    document.getElementById('edit_stock').value = stock;
    document.getElementById('edit_available').checked = available;
    document.getElementById('edit_category').value = categoryId;
    
    new bootstrap.Modal(document.getElementById('editProductModal')).show();
}

// Mobile-specific enhancements
document.addEventListener('DOMContentLoaded', function() {
    // Add touch feedback for mobile buttons
    const buttons = document.querySelectorAll('.btn');
    buttons.forEach(button => {
        button.addEventListener('touchstart', function() {
            this.style.transform = 'scale(0.98)';
        });
        
        button.addEventListener('touchend', function() {
            this.style.transform = '';
        });
    });
    
    // Prevent zoom on input focus (iOS)
    const inputs = document.querySelectorAll('input[type="text"], input[type="email"], input[type="tel"], input[type="number"], textarea');
    inputs.forEach(input => {
        input.addEventListener('focus', function() {
            if (window.innerWidth <= 768) {
                this.style.fontSize = '16px';
            }
        });
    });
    
    // Mobile navigation improvements
    const navbarToggler = document.querySelector('.navbar-toggler');
    const navbarCollapse = document.querySelector('.navbar-collapse');
    
    if (navbarToggler && navbarCollapse) {
        // Close mobile menu when clicking outside
        document.addEventListener('click', function(e) {
            if (!navbarToggler.contains(e.target) && !navbarCollapse.contains(e.target)) {
                if (navbarCollapse.classList.contains('show')) {
                    navbarToggler.click();
                }
            }
        });
    }
});
</script>
{% endblock %} 