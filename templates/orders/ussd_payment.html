{% extends 'base.html' %}
{% load static %}

{% block title %}USSD Payment - Order #{{ order.id }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="max-w-2xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">USSD Payment</h1>
            <p class="text-gray-600">Complete your payment using USSD banking</p>
        </div>

        <!-- Order Summary -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-4">Order Summary</h2>
            <div class="space-y-3">
                <div class="flex justify-between">
                    <span class="text-gray-600">Order ID:</span>
                    <span class="font-medium">#{{ order.id }}</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600">Total Amount:</span>
                    <span class="font-bold text-green-600">₦{{ order.get_total_cost|floatformat:2 }}</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600">Payment Method:</span>
                    <span class="font-medium">USSD Banking</span>
                </div>
            </div>
        </div>

        <!-- Payment Form -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-4">Select Your Bank</h2>
            
            <form method="post" class="space-y-6">
                {% csrf_token %}
                
                <!-- Bank Selection -->
                <div>
                    <label for="bank_code" class="block text-sm font-medium text-gray-700 mb-2">
                        Select Your Bank
                    </label>
                    <select name="bank_code" id="bank_code" required 
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent">
                        <option value="">Choose your bank...</option>
                        <option value="gtbank">GT Bank</option>
                        <option value="zenith">Zenith Bank</option>
                        <option value="access">Access Bank</option>
                        <option value="firstbank">First Bank</option>
                        <option value="uba">UBA</option>
                        <option value="fidelity">Fidelity Bank</option>
                        <option value="ecobank">Ecobank</option>
                        <option value="stanbic">Stanbic IBTC</option>
                        <option value="union">Union Bank</option>
                        <option value="wema">Wema Bank</option>
                    </select>
                </div>

                <!-- Account Number -->
                <div>
                    <label for="account_number" class="block text-sm font-medium text-gray-700 mb-2">
                        Account Number
                    </label>
                    <input type="text" name="account_number" id="account_number" required
                           placeholder="Enter your 10-digit account number"
                           pattern="[0-9]{10}"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent">
                    <p class="text-sm text-gray-500 mt-1">Enter your 10-digit NUBAN account number</p>
                </div>

                <!-- Payment Instructions -->
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <h3 class="font-semibold text-blue-900 mb-2">Payment Instructions</h3>
                    <ul class="text-sm text-blue-800 space-y-1">
                        <li>• Dial the USSD code for your selected bank</li>
                        <li>• Enter your PIN when prompted</li>
                        <li>• Confirm the payment amount: <strong>₦{{ payment_info.amount|floatformat:2 }}</strong></li>
                        <li>• Use reference: <strong>{{ payment_info.reference }}</strong></li>
                        <li>• Keep the transaction receipt for verification</li>
                    </ul>
                </div>

                <!-- USSD Codes Reference -->
                <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                    <h3 class="font-semibold text-gray-900 mb-2">USSD Codes Reference</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                        <div><strong>GT Bank:</strong> *737*1*[Account]*[Amount]#</div>
                        <div><strong>Zenith:</strong> *966*[Account]*[Amount]#</div>
                        <div><strong>Access:</strong> *901*[Account]*[Amount]#</div>
                        <div><strong>First Bank:</strong> *894*[Account]*[Amount]#</div>
                        <div><strong>UBA:</strong> *919*[Account]*[Amount]#</div>
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="flex space-x-4">
                    <button type="submit" 
                            class="flex-1 bg-green-600 text-white py-3 px-6 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition duration-200">
                        <i class="fas fa-mobile-alt mr-2"></i>
                        Generate USSD Code
                    </button>
                    <a href="{% url 'orders:order_success' order.id %}" 
                       class="bg-gray-300 text-gray-700 py-3 px-6 rounded-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition duration-200">
                        Cancel
                    </a>
                </div>
            </form>
        </div>

        <!-- Important Notes -->
        <div class="mt-6 bg-yellow-50 border border-yellow-200 rounded-lg p-4">
            <h3 class="font-semibold text-yellow-900 mb-2">Important Notes</h3>
            <ul class="text-sm text-yellow-800 space-y-1">
                <li>• Ensure you have sufficient funds in your account</li>
                <li>• Keep your phone nearby to receive transaction notifications</li>
                <li>• Payment verification may take 5-10 minutes</li>
                <li>• Contact support if you encounter any issues</li>
            </ul>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const bankSelect = document.getElementById('bank_code');
    const accountInput = document.getElementById('account_number');
    
    // Validate account number format
    accountInput.addEventListener('input', function() {
        const value = this.value.replace(/\D/g, '');
        if (value.length > 10) {
            this.value = value.slice(0, 10);
        }
    });
    
    // Show bank-specific instructions
    bankSelect.addEventListener('change', function() {
        const selectedBank = this.value;
        // You can add bank-specific instructions here if needed
    });
});
</script>
{% endblock %} 